<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Troca de senha — NovaTI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="./css/main.css" rel="stylesheet" />
    <style>
      .page {
        max-width: 640px;
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container bar">
        <div class="brand">
          <img src="assets/logo.png" alt="Logo" />
          <div class="title">NovaTI</div>
        </div>
        <nav class="nav">
          <a href="./index.html">Início</a>
          <a class="link-login" href="./login.html">Login</a>
          <a class="link-services" style="display: none" href="./services.html"
            >Solicitar serviços</a
          >
        </nav>
      </div>
    </header>

    <main class="container page panel">
      <h1>Troca de senha de clientes</h1>

      <div class="card">
        <h3>Regras da senha</h3>
        <ul>
          <li>Mínimo de <strong>6 caracteres</strong>;</li>
          <li>
            Conter pelo menos: <strong>1 número</strong>,
            <strong>1 letra maiúscula</strong> e
            <strong>1 caractere especial permitido</strong>;
          </li>
          <li>
            Especiais permitidos: <code>@ # $ % & * ! ? / \ | - _ + . =</code>
          </li>
          <li>
            <span class="bad">Não permitidos</span>:
            <code>¨ { } [ ] ´ ` ~ ^ : ; &lt; &gt; , " '</code>
          </li>
        </ul>
      </div>

      <form id="pwForm" novalidate>
        <label for="email">Login (e-mail)</label>
        <input
          id="email"
          type="email"
          placeholder="voce@exemplo.com"
          required
        />

        <label for="pw1">Nova senha</label>
        <input id="pw1" type="password" required />

        <label for="pw2">Confirmar senha</label>
        <input id="pw2" type="password" required />

        <div
          id="msg"
          class="bad"
          aria-live="polite"
          style="min-height: 1.2rem; margin: 0.4rem 0"
        ></div>

        <div class="grid-2">
          <button type="submit">Trocar Senha</button>
          <button type="button" class="secondary" id="btnClear">Limpar</button>
        </div>
      </form>
    </main>

    <script src="./js/common.js"></script>
    <script>
      const form = document.getElementById("pwForm");
      const emailEl = document.getElementById("email");
      const pw1 = document.getElementById("pw1");
      const pw2 = document.getElementById("pw2");
      const msg = document.getElementById("msg");

      document.getElementById("btnClear").addEventListener("click", () => {
        form.reset();
        emailEl.focus();
        setAlert(msg, "", "ok");
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const email = emailEl.value.trim();
        if (!email) return setAlert(msg, "Preencha o login.", "bad");
        if (!EMAIL_RE.test(email))
          return setAlert(msg, "Formato de e-mail inválido.", "bad");
        if (!pw1.value) return setAlert(msg, "Preencha a senha.", "bad");
        if (!pw2.value) return setAlert(msg, "Confirme a senha.", "bad");
        if (pw1.value !== pw2.value)
          return setAlert(msg, "As senhas não conferem.", "bad");
        if (!isStrongPassword(pw1.value))
          return setAlert(
            msg,
            "Senha fraca/contém caracteres não permitidos. Revise as regras.",
            "bad"
          );

        alert("Validação realizada com sucesso");
        history.back();
      });
    </script>
  </body>
</html>
